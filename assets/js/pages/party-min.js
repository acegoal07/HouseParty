window.addEventListener("load",(()=>{const e=new URLSearchParams(window.location.search).get("session_code"),t=document.querySelector("div#loading-icon");e||(window.location.href="/houseparty/join.html");const s=document.querySelector("form#search-song-form"),a=document.querySelector("div#search-results");let n;function o(){fetch(`assets/php/website/databasePartyHandlers.php?type=checkPartyExistsUser&partyId=${e}`,{method:"GET"}).then((e=>e.json())).then((t=>{if(t.partyExists||(window.location.href="/houseparty/join.html"),0===document.querySelector("div#party-qrcode").childElementCount){const t="https://aw1443.brighton.domains/houseparty/party.html?session_code=";document.querySelector("span#party-code").textContent=e,document.querySelector("button#copy-party-url").setAttribute("copy-data",`${t}${e}`),document.querySelector("button#share-party-url").setAttribute("data-party-url",`${t}${e}`),new QRCode(document.querySelector("div#party-qrcode"),{text:`${t}${e}`,width:150,height:150})}t.explicit!==n&&(document.querySelector("p.explicit-indicator").textContent=t.explicit?"enabled":"disabled",n=t.explicit,a.hasChildNodes()&&c())})).catch((e=>{}))}function c(){for(t.classList.remove("hidden");a.firstChild;)a.removeChild(a.firstChild);const s=document.querySelector("input#search-term"),n=s.value||a.getAttribute("data-current-search");a.setAttribute("data-current-search",n),s.value="",n&&""!==n.replaceAll(" ","")?fetch(`assets/php/website/spotifyHandler.php?type=searchSongByName&searchTerm=${n}&partyId=${e}`,{method:"GET"}).then((e=>e.json())).then((s=>{const n=s.tracks;for(const s in n)if(n.hasOwnProperty(s)){const o=n[s],c=document.createElement("div");c.className="search-results-item",c.tabIndex=0;const d=document.createElement("img");d.src=o.album.images[0].url,d.alt=`${o.name} cover`,d.className="search-results-cover",c.appendChild(d);const r=document.createElement("div");r.className="search-results-info-container";const i=document.createElement("p");if(i.className="search-results-title",i.textContent=o.name,r.appendChild(i),o.explicit){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("class","search-results-explicit-icon"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d","M2.5 0A2.5 2.5 0 0 0 0 2.5v11A2.5 2.5 0 0 0 2.5 16h11a2.5 2.5 0 0 0 2.5-2.5v-11A2.5 2.5 0 0 0 13.5 0zm4.326 10.88H10.5V12h-5V4.002h5v1.12H6.826V7.4h3.457v1.073H6.826z"),e.appendChild(t),i.appendChild(e)}const l=document.createElement("p");l.className="search-results-creators";const u=o.artists.map((e=>e.name));l.textContent=u.join(", "),r.appendChild(l),c.appendChild(r);const h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttribute("class","search-results-add-song-icon"),h.setAttribute("viewBox","0 0 512 512"),h.setAttribute("xmlns","http://www.w3.org/2000/svg");const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d","M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM232 344l0-64-64 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l64 0 0-64c0-13.3 10.7-24 24-24s24 10.7 24 24l0 64 64 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-64 0 0 64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"),h.appendChild(p),h.addEventListener("click",(()=>{t.classList.remove("hidden"),fetch("assets/php/website/spotifyHandler.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=addSongToQueue&songId=${o.uri}&partyId=${e}`}).then((e=>e.json())).then((e=>{if(t.classList.add("hidden"),e.success)switch(e.responseCode){case 1:document.dispatchEvent(new CustomEvent("openModal",{detail:{target:"add-to-queue-successfully-modal",callback:()=>{document.querySelector("#add-queue-successfully-song-name").textContent=`${o.name} by ${u.join(", ")}`}}}));break;case 2:document.dispatchEvent(new CustomEvent("openModal",{detail:{target:"add-to-queue-duplicate-modal",callback:()=>{document.querySelector("#add-queue-duplicate-song-name").textContent=`${o.name} by ${u.join(", ")}`}}}));break;case 3:document.dispatchEvent(new CustomEvent("openModal",{detail:{target:"add-to-queue-not-playing-modal"}}));break;default:document.dispatchEvent(new CustomEvent("openModal",{detail:{target:"add-to-queue-failed-modal"}}));break}}))})),c.appendChild(h),a.appendChild(c)}t.classList.add("hidden")})).catch((e=>{})):t.classList.add("hidden")}o(),setInterval(o,1500),s.addEventListener("submit",(e=>{e.preventDefault(),c()})),t.classList.add("hidden")}));