window.addEventListener("load",(()=>{const e=new URLSearchParams(window.location.search).get("session_code"),t=document.querySelector("div#loading-icon");e||(window.location.href="/houseparty/join.html");const s=document.querySelector("form#search-song-form"),n=document.querySelector("div#search-results");let a;function r(){fetch(`assets/php/website/databasePartyHandlers.php?type=checkPartyExistsUser&partyId=${e}`,{method:"GET"}).then((e=>e.json())).then((e=>{e.partyExists||(window.location.href="/houseparty/join.html"),e.explicit!==a&&(document.querySelector("p.explicit-indicator").textContent=e.explicit?"enabled":"disabled",a=e.explicit,n.hasChildNodes()&&c())}))}function c(){for(t.classList.remove("hidden");n.firstChild;)n.removeChild(n.firstChild);const s=document.querySelector("input#search-term"),a=s.value||n.getAttribute("data-current-search");n.setAttribute("data-current-search",a),s.value="",a&&""!==a.replaceAll(" ","")?fetch(`assets/php/website/spotifyHandler.php?type=searchSongByName&searchTerm=${a}&partyId=${e}`,{method:"GET"}).then((e=>e.json())).then((s=>{const a=s.tracks;for(const t in a)if(a.hasOwnProperty(t)){const s=a[t],r=document.createElement("div");r.className="search-results-item",r.tabIndex=0;const c=document.createElement("img");c.src=s.album.images[0].url,c.alt=`${s.name} cover`,c.className="search-results-cover",r.appendChild(c);const o=document.createElement("div");o.className="search-results-info-container";const i=document.createElement("p");if(i.className="search-results-title",i.textContent=s.name,o.appendChild(i),s.explicit){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("class","search-results-explicit-icon"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d","M2.5 0A2.5 2.5 0 0 0 0 2.5v11A2.5 2.5 0 0 0 2.5 16h11a2.5 2.5 0 0 0 2.5-2.5v-11A2.5 2.5 0 0 0 13.5 0zm4.326 10.88H10.5V12h-5V4.002h5v1.12H6.826V7.4h3.457v1.073H6.826z"),e.appendChild(t),i.appendChild(e)}const d=document.createElement("p");d.className="search-results-creators";const l=s.artists.map((e=>e.name));d.textContent=l.join(", "),o.appendChild(d),r.appendChild(o);const h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttribute("class","search-results-add-song-icon"),h.setAttribute("viewBox","0 0 512 512"),h.setAttribute("xmlns","http://www.w3.org/2000/svg");const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d","M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM232 344l0-64-64 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l64 0 0-64c0-13.3 10.7-24 24-24s24 10.7 24 24l0 64 64 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-64 0 0 64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"),h.appendChild(p),h.addEventListener("click",(()=>{fetch("assets/php/website/spotifyHandler.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=addSongToQueue&songId=${s.uri}&partyId=${e}`}).then((e=>e.json())).then((e=>{}))})),r.appendChild(h),n.appendChild(r)}t.classList.add("hidden")})):t.classList.add("hidden")}r(),setInterval(r,1500),s.addEventListener("submit",(e=>{e.preventDefault(),c()})),t.classList.add("hidden")}));