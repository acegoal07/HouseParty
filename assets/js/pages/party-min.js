window.addEventListener("load",(()=>{const e=new URLSearchParams(window.location.search).get("session_code"),t=document.querySelector("div#loading-icon");e||(window.location.href="/houseparty/join.html");const s=document.querySelector("form#search-song-form"),n=document.querySelector("div#search-results");let a;function c(){fetch(`assets/php/website/databasePartyHandlers.php?type=checkPartyExistsUser&partyId=${e}`,{method:"GET"}).then((e=>e.json())).then((e=>{e.partyExists||(window.location.href="/houseparty/join.html"),e.explicit!==a&&(document.querySelector("p.explicit-indicator").textContent=e.explicit?"enabled":"disabled",a=e.explicit,n.hasChildNodes()&&o())}))}function o(){for(t.classList.remove("hidden");n.firstChild;)n.removeChild(n.firstChild);const s=document.querySelector("input#search-term"),a=s.value||n.getAttribute("data-current-search");n.setAttribute("data-current-search",a),s.value="",a&&""!==a.replaceAll(" ","")?fetch(`assets/php/website/spotifyHandler.php?type=searchSongByName&searchTerm=${a}&partyId=${e}`,{method:"GET"}).then((e=>e.json())).then((s=>{const a=s.tracks;for(const s in a)if(a.hasOwnProperty(s)){const c=a[s],o=document.createElement("div");o.className="search-results-item",o.tabIndex=0;const r=document.createElement("img");r.src=c.album.images[0].url,r.alt=`${c.name} cover`,r.className="search-results-cover",o.appendChild(r);const d=document.createElement("div");d.className="search-results-info-container";const i=document.createElement("p");if(i.className="search-results-title",i.textContent=c.name,d.appendChild(i),c.explicit){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("class","search-results-explicit-icon"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d","M2.5 0A2.5 2.5 0 0 0 0 2.5v11A2.5 2.5 0 0 0 2.5 16h11a2.5 2.5 0 0 0 2.5-2.5v-11A2.5 2.5 0 0 0 13.5 0zm4.326 10.88H10.5V12h-5V4.002h5v1.12H6.826V7.4h3.457v1.073H6.826z"),e.appendChild(t),i.appendChild(e)}const l=document.createElement("p");l.className="search-results-creators";const h=c.artists.map((e=>e.name));l.textContent=h.join(", "),d.appendChild(l),o.appendChild(d);const p=document.createElementNS("http://www.w3.org/2000/svg","svg");p.setAttribute("class","search-results-add-song-icon"),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xmlns","http://www.w3.org/2000/svg");const u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d","M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM232 344l0-64-64 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l64 0 0-64c0-13.3 10.7-24 24-24s24 10.7 24 24l0 64 64 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-64 0 0 64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"),p.appendChild(u),p.addEventListener("click",(()=>{t.classList.remove("hidden"),fetch("assets/php/website/spotifyHandler.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=addSongToQueue&songId=${c.uri}&partyId=${e}`}).then((e=>e.text())).then((e=>{t.classList.add("hidden"),document.dispatchEvent(new CustomEvent("openModal",{detail:{target:"add-to-queue-successfully-modal",callback:()=>{document.querySelector("#add-queue-successfully-song-name").textContent=`${c.name} by ${h.join(", ")}`}}}))}))})),o.appendChild(p),n.appendChild(o)}t.classList.add("hidden")})):t.classList.add("hidden")}c(),setInterval(c,1500),s.addEventListener("submit",(e=>{e.preventDefault(),o()})),t.classList.add("hidden")}));