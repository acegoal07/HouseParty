window.addEventListener("load",(()=>{getCookie("refresh_token")&&getCookie("host_id")||(deleteCookie({name:"refresh_token"}),deleteCookie({name:"host_id"}),window.location.href="/houseparty/"),document.querySelector("input#extend-duration").value=4,document.querySelector("input#party-duration").value=4;const e=document.querySelector("button#disable-explicit-button"),t=document.querySelector("button#enable-explicit-button"),o=document.querySelector("div#loading-icon");let s;function d(){if(!s)return;const e=new Date(s),t=e.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!0}),o=e.toLocaleDateString(void 0,{year:"numeric",month:"numeric",day:"numeric"});document.querySelector("div#expires-at-time").textContent=`${t}`,document.querySelector("div#expires-at-date").textContent=`${o}`}function n(){const n=new URLSearchParams({type:"checkPartyExistsHost",hostId:`${getCookie("host_id")}`,refreshToken:`${getCookie("refresh_token")}`});fetch(`assets/php/website/databasePartyHandlers.php?${n}`,{method:"GET"}).then((e=>e.json())).then((n=>{if(n.partyExists){if(n.refreshTokenValid||(deleteCookie({name:"refresh_token"}),deleteCookie({name:"host_id"}),window.location.href="/houseparty/"),0===document.querySelector("div#party-qrcode").childElementCount){s=new Date(n.partyExpiresAt),d();const e="https://aw1443.brighton.domains/houseparty/party.html?session_code=";document.querySelector("span#party-code").textContent=n.partyId,document.querySelector("button#copy-party-url").setAttribute("copy-data",`${e}${n.partyId}`),document.querySelector("button#share-party-url").setAttribute("data-party-url",`${e}${n.partyId}`),new QRCode(document.querySelector("div#party-qrcode"),{text:`${e}${n.partyId}`,width:150,height:150})}n.partyExpiresAt!==s&&(s=n.partyExpiresAt,d()),n.explicit?(t.classList.contains("hidden")||t.classList.add("hidden"),e.classList.remove("hidden")):(e.classList.contains("hidden")||e.classList.add("hidden"),t.classList.remove("hidden")),document.querySelector("form#start-party-form").classList.contains("hidden")||document.querySelector("form#start-party-form").classList.add("hidden"),document.querySelector("div#manage-party-buttons").classList.remove("hidden")}else document.dispatchEvent(new Event("closeCurrentModal")),document.querySelector("div#manage-party-buttons").classList.contains("hidden")||document.querySelector("div#manage-party-buttons").classList.add("hidden"),document.querySelector("form#start-party-form").classList.remove("hidden");o.classList.contains("hidden")||o.classList.add("hidden")}))}n(),setInterval(n,1500),document.querySelector("form#start-party-form").addEventListener("submit",(e=>{e.preventDefault(),o.classList.remove("hidden"),fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=createParty&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}&partyEndsIn=${document.querySelector("input#party-duration").value}&explicit=${document.querySelector("input#explicit-allowed").checked?1:0}`}).then((e=>e.json())).then((e=>{e.success&&(window.location.reload(),o.classList.add("hidden"))}))})),document.querySelector("form#extend-party-form").addEventListener("submit",(e=>{e.preventDefault(),o.classList.remove("hidden");const t=document.querySelector("input#extend-duration").value;fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=extendPartyDuration&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}&extendBy=${t}`}).then((e=>e.json())).then((e=>{e.success&&document.dispatchEvent(new CustomEvent("closeCurrentModal",{detail:{callback:()=>{o.classList.remove("hidden")}}}))}))})),e.addEventListener("click",(s=>{s.preventDefault(),o.classList.remove("hidden"),fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=updatePartyExplicit&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}&explicit=0`}).then((e=>e.json())).then((s=>{s.success&&(e.classList.add("hidden"),t.classList.remove("hidden"),o.classList.add("hidden"))}))})),t.addEventListener("click",(s=>{s.preventDefault(),o.classList.remove("hidden"),fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=updatePartyExplicit&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}&explicit=1`}).then((e=>e.json())).then((s=>{s.success&&(t.classList.add("hidden"),e.classList.remove("hidden"),o.classList.add("hidden"))}))})),document.querySelector("button#confirm-end-party-button").addEventListener("click",(e=>{e.preventDefault(),o.classList.remove("hidden"),fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=deleteParty&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}`}).then((e=>e.json())).then((e=>{e.success&&(window.location.reload(),o.classList.add("hidden"))}))}))}));