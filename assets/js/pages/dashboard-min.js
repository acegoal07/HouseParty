window.addEventListener("load",(()=>{document.querySelector("input#extend-duration").value=4,document.querySelector("input#party-duration").value=4;const e=document.querySelector("button#disable-explicit-button"),t=document.querySelector("button#enable-explicit-button"),o=document.querySelector("button#disable-duplicate-blocker-button"),s=document.querySelector("button#enable-duplicate-blocker-button"),d=document.querySelector("div#loading-icon"),n=document.querySelector("form#start-party-form");let a;function r(){if(!a)return;const e=new Date(a),t=e.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!0}),o=e.toLocaleDateString(void 0,{year:"numeric",month:"numeric",day:"numeric"});document.querySelector("div#expires-at-time").textContent=`${t}`,document.querySelector("div#expires-at-date").textContent=`${o}`}function i(){getCookie("refresh_token")&&getCookie("host_id")||(deleteCookie({name:"refresh_token"}),deleteCookie({name:"host_id"}),window.location.href="/houseparty/");const i=new URLSearchParams({type:"checkPartyExistsHost",hostId:`${getCookie("host_id")}`,refreshToken:`${getCookie("refresh_token")}`});fetch(`assets/php/website/databasePartyHandlers.php?${i}`,{method:"GET"}).then((e=>e.json())).then((i=>{if(i.partyExists){if(i.refreshTokenValid||(deleteCookie({name:"refresh_token"}),deleteCookie({name:"host_id"}),window.location.href="/houseparty/"),0===document.querySelector("div#party-qrcode").childElementCount){a=new Date(i.partyExpiresAt),r();const e="https://aw1443.brighton.domains/houseparty/party.html?session_code=";document.querySelector("span#party-code").textContent=i.partyId,document.querySelector("button#copy-party-url").setAttribute("copy-data",`${e}${i.partyId}`),document.querySelector("button#share-party-url").setAttribute("data-party-url",`${e}${i.partyId}`),new QRCode(document.querySelector("div#party-qrcode"),{text:`${e}${i.partyId}`,width:150,height:150})}i.partyExpiresAt!==a&&(a=i.partyExpiresAt,r()),i.explicit?(t.classList.add("hidden"),e.classList.remove("hidden")):(e.classList.add("hidden"),t.classList.remove("hidden")),i.duplicateBlocker?(s.classList.add("hidden"),o.classList.remove("hidden")):(o.classList.add("hidden"),s.classList.remove("hidden")),n.classList.contains("hidden")||n.classList.add("hidden"),document.querySelector("div#manage-party-buttons").classList.remove("hidden")}else document.dispatchEvent(new Event("closeCurrentModal")),document.querySelector("div#manage-party-buttons").classList.contains("hidden")||document.querySelector("div#manage-party-buttons").classList.add("hidden"),n.classList.remove("hidden");d.classList.contains("hidden")||d.classList.add("hidden")})).catch((e=>{}))}function c(){extendCookie({name:"refresh_token",days:1}),extendCookie({name:"host_id",days:1})}i(),setInterval(i,1500),c(),setInterval(c,9e5),n.addEventListener("submit",(e=>{e.preventDefault(),d.classList.remove("hidden"),fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=createParty&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}&partyEndsIn=${document.querySelector("input#party-duration").value}&explicit=${document.querySelector("input#explicit-allowed").checked?1:0}&duplicateBlocker=${document.querySelector("input#duplicate_blocker").checked?1:0}`}).then((e=>e.json())).then((t=>{t.success?(e.target.reset(),window.location.reload(),d.classList.add("hidden")):(deleteCookie({name:"refresh_token"}),deleteCookie({name:"host_id"}),window.location.href="/houseparty/")}))})),document.querySelector("form#extend-party-form").addEventListener("submit",(e=>{e.preventDefault(),d.classList.remove("hidden");const t=document.querySelector("input#extend-duration").value;fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=extendPartyDuration&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}&extendBy=${t}`}).then((e=>e.json())).then((t=>{t.success&&document.dispatchEvent(new CustomEvent("closeCurrentModal",{detail:{callback:()=>{d.classList.remove("hidden"),e.target.reset()}}}))}))})),e.addEventListener("click",(o=>{o.preventDefault(),d.classList.remove("hidden"),fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=updatePartyExplicit&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}&explicit=0`}).then((e=>e.json())).then((o=>{o.success&&(e.classList.add("hidden"),t.classList.remove("hidden"),d.classList.add("hidden"))}))})),t.addEventListener("click",(o=>{o.preventDefault(),d.classList.remove("hidden"),fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=updatePartyExplicit&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}&explicit=1`}).then((e=>e.json())).then((o=>{o.success&&(t.classList.add("hidden"),e.classList.remove("hidden"),d.classList.add("hidden"))}))})),o.addEventListener("click",(e=>{e.preventDefault(),d.classList.remove("hidden"),fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=updatePartyDuplicateBlocker&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}&duplicateBlocker=0`}).then((e=>e.json())).then((e=>{e.success&&(o.classList.add("hidden"),s.classList.remove("hidden"),d.classList.add("hidden"))}))})),s.addEventListener("click",(e=>{e.preventDefault(),d.classList.remove("hidden"),fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=updatePartyDuplicateBlocker&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}&duplicateBlocker=1`}).then((e=>e.json())).then((e=>{e.success&&(s.classList.add("hidden"),o.classList.remove("hidden"),d.classList.add("hidden"))}))})),document.querySelector("button#confirm-end-party-button").addEventListener("click",(e=>{e.preventDefault(),d.classList.remove("hidden"),fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=deleteParty&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}`}).then((e=>e.json())).then((e=>{e.success&&(window.location.reload(),d.classList.add("hidden"))}))}))}));