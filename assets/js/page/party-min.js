window.addEventListener("load",(()=>{const e=new URLSearchParams(window.location.search).get("session_code"),t=document.querySelector("div#loading-icon");e||(window.location.href="/houseparty/join.html");const s=document.querySelector("form#search-song-form"),a=document.querySelector("div#search-results"),n=document.querySelector("span#no-results");let o;function c(){fetch(`assets/php/website/databasePartyHandlers.php?type=checkPartyExistsUser&partyId=${e}`,{method:"GET"}).then((e=>e.json())).then((t=>{if(t.partyExists||(window.location.href="/houseparty/join.html"),0===document.querySelector("div#party-qrcode").childElementCount){const t="https://aw1443.brighton.domains/houseparty/party.html?session_code=";document.querySelector("span#party-code").textContent=e,document.querySelector("button#copy-party-url").setAttribute("copy-data",`${t}${e}`),document.querySelector("button#share-party-url").setAttribute("data-party-url",`${t}${e}`),new QRCode(document.querySelector("div#party-qrcode"),{text:`${t}${e}`,width:150,height:150})}t.explicit!==o&&(o=t.explicit,a.hasChildNodes()&&r())})).catch((e=>{}))}function r(){t.classList.remove("hide"),Array.from(a.children).forEach((e=>{"SPAN"!==e.tagName&&a.removeChild(e)}));const o=s.querySelector("input"),c=o.value||a.getAttribute("data-current-search");if(a.setAttribute("data-current-search",c),o.value="",!c||""===c.replaceAll(" ",""))return n.classList.remove("hide"),void t.classList.add("hide");fetch(`assets/php/website/spotifyHandler.php?type=searchSongByName&searchTerm=${c}&partyId=${e}`,{method:"GET"}).then((e=>e.json())).then((s=>{const o=s.tracks;0!==Object.keys(o).length?n.classList.add("hide"):n.classList.remove("hide");const c=Object.keys(o).slice(0,20);for(const s of c){const n=o[s],c=document.createElement("div");c.className="search-results-item";const r=document.createElement("img");r.src=n.album.images[0].url,r.alt=`${n.name} cover`,r.className="search-results-cover",c.appendChild(r);const d=document.createElement("div");d.className="search-results-info-container";const l=document.createElement("p");if(l.className="search-results-title",l.textContent=n.name,d.appendChild(l),n.explicit){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("class","search-results-explicit-icon"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d","M2.5 0A2.5 2.5 0 0 0 0 2.5v11A2.5 2.5 0 0 0 2.5 16h11a2.5 2.5 0 0 0 2.5-2.5v-11A2.5 2.5 0 0 0 13.5 0zm4.326 10.88H10.5V12h-5V4.002h5v1.12H6.826V7.4h3.457v1.073H6.826z"),e.appendChild(t),l.appendChild(e)}const i=document.createElement("p");i.className="search-results-artists";const u=30;let h=0;const p=[];let m=0;for(let e=0;e<n.artists.length;e++){const t=n.artists[e].name;if(!(h+t.length<=u)){m=n.artists.length-e;break}p.push(t),h+=t.length}let y=p.join(", ");m>0&&(y+=`, and ${m} more`),i.textContent=y,d.appendChild(i),c.appendChild(d);const w=document.createElementNS("http://www.w3.org/2000/svg","svg");w.setAttribute("class","search-results-add-song-icon"),w.setAttribute("viewBox","0 0 512 512"),w.setAttribute("xmlns","http://www.w3.org/2000/svg"),w.tabIndex=0,w.setAttribute("aria-label",`Add ${n.name} by ${y}`),w.setAttribute("role","button");const v=document.createElementNS("http://www.w3.org/2000/svg","path");v.setAttribute("d","M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM232 344l0-64-64 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l64 0 0-64c0-13.3 10.7-24 24-24s24 10.7 24 24l0 64 64 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-64 0 0 64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"),w.appendChild(v);const b=s=>{"click"!==s.type&&("keydown"!==s.type||"Enter"!==s.key&&" "!==s.key)||(t.classList.remove("hide"),fetch("assets/php/website/spotifyHandler.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=addSongToQueue&songId=${n.uri}&partyId=${e}`}).then((e=>e.json())).then((e=>{if(t.classList.add("hide"),e.success)switch(e.responseCode){case 1:document.dispatchEvent(new CustomEvent("openModal",{detail:{target:"add-to-queue-successfully-modal",callback:()=>{document.querySelector("#add-queue-successfully-song-name").textContent=`${n.name} by ${y}`}}}));break;case 2:document.dispatchEvent(new CustomEvent("openModal",{detail:{target:"add-to-queue-duplicate-modal",callback:()=>{document.querySelector("#add-queue-duplicate-song-name").textContent=`${n.name} by ${y}`}}}));break;case 3:document.dispatchEvent(new CustomEvent("openModal",{detail:{target:"add-to-queue-not-playing-modal"}}));break;default:document.dispatchEvent(new CustomEvent("openModal",{detail:{target:"add-to-queue-failed-modal"}}));break}})))};w.addEventListener("keydown",b),w.addEventListener("click",b),c.appendChild(w),a.appendChild(c)}t.classList.add("hide")})).catch((e=>{}))}c(),setInterval(c,1500),s.addEventListener("submit",(e=>{e.preventDefault(),r()})),t.classList.add("hide")}));