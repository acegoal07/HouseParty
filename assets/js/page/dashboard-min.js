window.addEventListener("load",(()=>{document.querySelector("input#party-duration").value=4;const e=document.querySelector("div#loading-icon"),t=document.querySelector("form#party-creation-form"),o=document.querySelector("div#settings"),r=document.querySelector("div#create-party");let n;function s(){getCookie("refresh_token")&&getCookie("host_id")||(deleteCookie({name:"refresh_token"}),deleteCookie({name:"host_id"}),window.location.href="/houseparty/");const t=new URLSearchParams({type:"checkPartyExistsHost",hostId:`${getCookie("host_id")}`,refreshToken:`${getCookie("refresh_token")}`});fetch(`assets/php/website/databasePartyHandlers.php?${t}`,{method:"GET"}).then((e=>e.json())).then((t=>{if(t.partyExists){if(t.refreshTokenValid||(deleteCookie({name:"refresh_token"}),deleteCookie({name:"host_id"}),window.location.href="/houseparty/"),0===document.querySelector("div#party-qrcode").childElementCount){n=new Date(t.partyExpiresAt),function(){if(!n)return;const e=new Date(n),t=e.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!0}),o=e.toLocaleDateString(void 0,{year:"numeric",month:"numeric",day:"numeric"});document.querySelector("div#expires-at-time").textContent=`${t}`,document.querySelector("div#expires-at-date").textContent=`${o}`}();const e="https://aw1443.brighton.domains/houseparty/party.html?session_code=";document.querySelector("span#party-code").textContent=t.partyId,document.querySelector("button#copy-party-url").setAttribute("copy-data",`${e}${t.partyId}`),document.querySelector("button#share-party-url").setAttribute("data-party-url",`${e}${t.partyId}`),new QRCode(document.querySelector("div#party-qrcode"),{text:`${e}${t.partyId}`,width:150,height:150})}r.classList.contains("hide")||r.classList.add("hide"),o.classList.remove("hide")}else o.classList.contains("hide")||o.classList.add("hide"),r.classList.remove("hide");e.classList.contains("hide")||e.classList.add("hide")})).catch((e=>{}))}function a(){extendCookie({name:"refresh_token",days:1}),extendCookie({name:"host_id",days:1})}s(),setInterval(s,1500),a(),setInterval(a,9e5),t.addEventListener("submit",(t=>{t.preventDefault(),e.classList.remove("hide"),fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=createParty&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}&partyEndsIn=${document.querySelector("input#party-duration").value}&explicit=${document.querySelector("input#explicit-checkbox").checked?1:0}&duplicateBlocker=${document.querySelector("input#duplicate-blocker-checkbox").checked?1:0}`}).then((e=>e.json())).then((o=>{o.success?(t.target.reset(),window.location.reload(),e.classList.add("hide")):(deleteCookie({name:"refresh_token"}),deleteCookie({name:"host_id"}),window.location.href="/houseparty/")}))})),document.querySelector("form#extend-party-form").addEventListener("submit",(t=>{t.preventDefault(),e.classList.remove("hide");const o=document.querySelector("input#extend-party-duration").value;fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=extendPartyDuration&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}&extendBy=${o}`}).then((e=>e.json())).then((o=>{o.success&&(t.target.reset(),e.classList.remove("hide"))}))})),document.querySelector("button#confirm-end-party-button").addEventListener("click",(t=>{t.preventDefault(),e.classList.remove("hide"),fetch("assets/php/website/databasePartyHandlers.php",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=deleteParty&hostId=${getCookie("host_id")}&refreshToken=${getCookie("refresh_token")}`}).then((e=>e.json())).then((t=>{t.success&&(window.location.reload(),e.classList.add("hide"))}))}))}));